#!/usr/bin/env python

# Work in progress

import json
import argparse
import subprocess

parser = argparse.ArgumentParser()
parser.add_argument(
    "action", nargs="?", default="list", choices=["list", "set", "set-switch"]
)
args = parser.parse_args()

monitors = json.loads(subprocess.check_output(["swaymsg", "-t", "get_outputs"], text=True))

identifier = ["make", "model", "serial"]

if args.action == "list":
    for index, monitor in enumerate(monitors):
        print(f"[{index}]", " ".join([monitor[key] for key in identifier]))
    exit()
elif args.action in ('set', 'set-switch'):
    names = [monitor['name'] for monitor in monitors]

    if args.action == 'set-switch':
        names = list(reversed(names))

    assert len(names) >= 2

    cmds = [
        ["swaymsg", "output", names[0], "pos", "0", "0", "res", "3840x2160"],
        ["swaymsg", "output", names[1], "pos", "3840", "0", "res", "3840x2160"],
    ]
    for cmd in cmds:
        print(" ".join(cmd))
        subprocess.run(cmd)
