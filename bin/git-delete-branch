#!/usr/bin/env ruby

require 'optparse'

opts = {
  remote: false,
  local: true,
}
parser = OptionParser.new do |op|
  op.banner = "usage: #{File.basename($0)} [options] <branch> ..."
  op.separator "default action is to delete the local branch"
  op.on("-r", "--remote", "delete *only* the remote branch") {|v| opts[:remote] = true; opts[:local] = false }
  op.on("-a", "--all", "delete local and remote branch") {|v| opts[:remote] = true; opts[:local] = true }
end
parser.parse!

if ARGV.size == 0
  puts parser
  exit
end

def run(cmd)
  puts cmd
  %x(#{cmd})
end

branches = ARGV.dup

branches.each do |branch|
  if opts[:local]
    run "git branch -D #{branch}"
  end

  if opts[:remote]
    run "git push origin :#{branch}"
  end
end
