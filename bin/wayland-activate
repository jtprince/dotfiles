#!/usr/bin/env python

import argparse
import subprocess
from pathlib import Path

HOME = Path.home()
CONFIG = HOME / ".config"
DOTFILES_CONFIGURE = "dotfiles-configure"


parser = argparse.ArgumentParser()
parser.add_argument(
    "state", choices=["on", "off"], help="set things to use wayland"
)
parser.add_argument("--dry", action="store_true", help="say don't do")
args = parser.parse_args()


def run(cmd: str):
    print(cmd)
    if not args.dry:
        subprocess.run(cmd, shell=True)


def uninstall(pkg: str):
    run(f"yay -Rs {pkg} --noconfirm")


def install(pkg: str):
    run(f"yay -S {pkg} --noconfirm")


# wayland
if args.state == "on":
    run(f"{DOTFILES_CONFIGURE} --display-server wayland")
    uninstall("xclip")
    install("wl-clipboard-x11")
    uninstall("bemenu-x11")
    install("bemenu-dmenu-wayland")
else:
    run(f"{DOTFILES_CONFIGURE} --display-server x11")
    uninstall("wl-clipboard-x11")
    install("xclip")
    uninstall("bemenu-dmenu-wayland")
    install("bemenu-x11")
