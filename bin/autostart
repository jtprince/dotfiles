#!/bin/bash

function cmd_exists {
    command -v "$1" >/dev/null 2>&1
}

if [ "$1" != "late" ]; then

    # gnome keyring
    eval $(gnome-keyring-daemon --start --components=gpg,pkcs11,secrets,ssh)

    # Xresources
    xrdb -merge ~/.Xresources
    if [ -e ~/.config/Xresources-local ]; then
        xrdb -merge ~/.config/Xresources-local
    fi

    # dunst
    dunst -config ~/.config/dunstrc &

    # pulseaudio
    start-pulseaudio-x11

    # xmodmap
    if [ ! -e "/dev/input/by-id/usb-Ultimate_Gadget_Laboratories_Ultimate_Hacking_Keyboard-if01-event-kbd" ]; then
        # if the UHK keyboard is not plugged in, then remap some keys!
        xmodmap ~/.config/xmodmap
    fi

    # thunar
    thunar --daemon &

    # lock screen
    if [ `hostname` != "sazedlinux" ]; then
        xautolock-start
    fi

    # battery icon
    if cmd_exists cbatticon ; then
        cbatticon &
    fi

    # clipboard
    xclip -silent &

    # network manager applet
    if cmd_exists nm-applet ; then
        nm-applet &
    fi

    # blockify
    if cmd_exists blockify ; then
        blockify &
    fi

    # dropbox
    if cmd_exists dropbox ; then
        dropbox start
    fi

    # now using pclcmd (see pcloud in Dropbox/env/../ for oath token)
    # pcloud
    # if cmd_exists psyncgui ; then
    #    ( sleep 10 && psyncgui )&
    # fi

    # sound tray
    pasystray &

    notify-send -u low 'initialized!'

else

    randomise-bkg

fi
