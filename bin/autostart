#!/bin/bash

function cmd_exists {
    command -v "$1" >/dev/null 2>&1
}

if [ "$1" != "late" ]; then
    eval $(gnome-keyring-daemon --start --components=gpg,pkcs11,secrets,ssh)
    xrdb -merge ~/.Xresources
    if [ -e ~/.config/Xresources-local ]; then
        xrdb -merge ~/.config/Xresources-local
    fi
    dunst -config ~/.config/dunstrc &
    start-pulseaudio-x11
    #if [ `hostname` != "luce" ]; then
        # luce defines shortcuts in evdev
        # yaourt -S xdotool
    xmodmap ~/.config/xmodmap
    #fi
    thunar --daemon &
    # xscreensaver &
    xautolock-start
    # yaourt -S pasystray-git pavucontrol paprefs pavumeter
    # also
    # echo "load-module module-device-manager" >> /etc/pulse/default.pa
    pasystray &
    xclip -silent &
    if cmd_exists nm-applet ; then
        nm-applet &
    fi
    if cmd_exists dropbox ; then
        dropbox start
        #( sleep 60 && dropbox start )&
    fi
    if cmd_exists CopyAgent ; then
        #( sleep 180 && CopyAgent& )&
        CopyAgent&
    fi
    if cmd_exists copy ; then
        #( sleep 180 && CopyAgent& )&
        copy&
    fi

    notify-send -u low 'initialized!'
else
    randomise-bkg
fi

#eval `dbus-launch --sh-syntax --exit-with-session`
